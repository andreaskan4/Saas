@page "/"
@using Microsoft.AspNetCore.Authorization
@attribute [AllowAnonymous]

<PageTitle>LabPortal-Home</PageTitle>

<div class="container mt-4">
    <div class="text-center mb-5">
        <h1 class="display-4 fw-bold text-primary">LabPortal Documentation</h1>
        <p class="lead text-muted">Αναλυτική παρουσίαση λειτουργιών και τεχνικής αρχιτεκτονικής.</p>
    </div>

    <div class="accordion shadow-sm" id="featuresAccordion">

        <div class="accordion-item">
            <h2 class="accordion-header" id="headingAuth">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAuth" aria-expanded="true" aria-controls="collapseAuth">
                    <strong>Ταυτοποίηση & Google Login</strong>
                </button>
            </h2>
            <div id="collapseAuth" class="accordion-collapse collapse show" aria-labelledby="headingAuth" data-bs-parent="#featuresAccordion">
                <div class="accordion-body">
                    <div class="row">
                        <div class="col-md-6 border-end">
                            <h6 class="text-success">Λειτουργία Χρήστη</h6>
                            <p>Ο χρήστης μπορεί να συνδεθεί είτε με Email/Password είτε με τον Google λογαριασμό του. Αν δεν υπάρχει λογαριασμός κατά την είσοδο με Google, δημιουργείται αυτόματα.</p>
                        </div>
                        <div class="col-md-6 bg-light p-3 rounded">
                            <h6 class="text-primary font-monospace">Τεχνική Υλοποίηση (Code)</h6>
                            <ul class="small">
                                <li><strong>Client:</strong> Χρησιμοποιεί το <code>Google Identity Services (JS)</code> για να πάρει το <code>ID Token</code> από την Google.</li>
                                <li><strong>API:</strong> Ο <code>AccountController</code> λαμβάνει το Google Token και το επαληθεύει μέσω της βιβλιοθήκης <code>Google.Apis.Auth</code>.</li>
                                <li><strong>JWT:</strong> Αν η επαλήθευση πετύχει, το API παράγει ένα δικό μας <strong>JWT Token</strong>.</li>
                                <li><strong>State:</strong> Ο <code>CustomAuthStateProvider</code> αποθηκεύει το JWT στο <code>LocalStorage</code> και ενημερώνει όλο το Blazor app ότι ο χρήστης είναι συνδεδεμένος.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="accordion-item">
            <h2 class="accordion-header" id="headingChat">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseChat" aria-expanded="false" aria-controls="collapseChat">
                    <strong>Real-Time Chat & Μηνύματα</strong>
                </button>
            </h2>
            <div id="collapseChat" class="accordion-collapse collapse" aria-labelledby="headingChat" data-bs-parent="#featuresAccordion">
                <div class="accordion-body">
                    <div class="row">
                        <div class="col-md-6 border-end">
                            <h6 class="text-success">Λειτουργία Χρήστη</h6>
                            <p>Οι χρήστες ανταλλάσσουν μηνύματα σε πραγματικό χρόνο. Όταν ένας χρήστης στέλνει μήνυμα, ο παραλήπτης το βλέπει αμέσως χωρίς να κάνει ανανέωση της σελίδας.</p>
                        </div>
                        <div class="col-md-6 bg-light p-3 rounded">
                            <h6 class="text-primary font-monospace">Τεχνική Υλοποίηση (Code)</h6>
                            <ul class="small">
                                <li><strong>Protocol:</strong> Χρήση <strong>WebSockets</strong> μέσω της βιβλιοθήκης <strong>SignalR</strong>.</li>
                                <li><strong>Server (Hub):</strong> Η κλάση <code>PortalHub.cs</code> διαχειρίζεται τις συνδέσεις. Κρατάει σε ένα <code>Dictionary</code> ποιος χρήστης (Email) αντιστοιχεί σε ποιο ConnectionId.</li>
                                <li><strong>Client:</strong> Το <code>Chat.razor</code> ανοίγει σύνδεση με το Hub (<code>hubConnection.StartAsync</code>).</li>
                                <li><strong>Ροή:</strong> Το μήνυμα στέλνεται στο API -> Αποθηκεύεται στη DB -> Το SignalR "σπρώχνει" (Push) το μήνυμα μόνο στον συγκεκριμένο παραλήπτη (<code>Clients.Client(targetId)</code>).</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="accordion-item">
            <h2 class="accordion-header" id="headingNotif">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseNotif" aria-expanded="false" aria-controls="collapseNotif">
                    <strong>Live Ειδοποιήσεις</strong>
                </button>
            </h2>
            <div id="collapseNotif" class="accordion-collapse collapse" aria-labelledby="headingNotif" data-bs-parent="#featuresAccordion">
                <div class="accordion-body">
                    <div class="row">
                        <div class="col-md-6 border-end">
                            <h6 class="text-success">Λειτουργία Χρήστη</h6>
                            <p>Όταν συμβαίνει κάτι (π.χ. νέο μήνυμα), εμφανίζεται μια κόκκινη ένδειξη στο καμπανάκι πάνω δεξιά, ακόμα και αν ο χρήστης είναι σε άλλη σελίδα.</p>
                        </div>
                        <div class="col-md-6 bg-light p-3 rounded">
                            <h6 class="text-primary font-monospace">Τεχνική Υλοποίηση (Code)</h6>
                            <ul class="small">
                                <li><strong>Component:</strong> Το <code>NotificationBell.razor</code> τρέχει συνεχώς στο <code>MainLayout</code>.</li>
                                <li><strong>SignalR Listener:</strong> Ακούει στο event <code>ReceiveNotification</code>.</li>
                                <li><strong>Threading:</strong> Επειδή το SignalR τρέχει σε background thread, χρησιμοποιούμε το <code>InvokeAsync(StateHasChanged)</code> για να ενημερώσουμε το UI χωρίς να κρασάρει (Dispatcher).</li>
                                <li><strong>CSS:</strong> Χρήση Bootstrap Icons (<code>bi-bell</code>) και Badges για την οπτική ένδειξη.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="accordion-item">
            <h2 class="accordion-header" id="headingArch">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseArch" aria-expanded="false" aria-controls="collapseArch">
                    <strong>Γενική Αρχιτεκτονική</strong>
                </button>
            </h2>
            <div id="collapseArch" class="accordion-collapse collapse" aria-labelledby="headingArch" data-bs-parent="#featuresAccordion">
                <div class="accordion-body">
                    <div class="alert alert-info">
                        <strong>Separation of Concerns:</strong> Το σύστημα είναι χωρισμένο σε δύο εντελώς ανεξάρτητα projects.
                    </div>
                    <ul>
                        <li>
                            <strong>LabPortal.API (Backend):</strong>
                            Είναι γραμμένο σε ASP.NET Core Web API. Μιλάει με τη βάση δεδομένων (SQL Server) μέσω <strong>Entity Framework Core</strong>. Δεν έχει καθόλου UI (Views), επιστρέφει μόνο JSON δεδομένα.
                        </li>
                        <li>
                            <strong>LabPortal.Client (Frontend):</strong>
                            Είναι γραμμένο σε <strong>Blazor Web App (Interactive Server)</strong>. Δεν έχει απευθείας πρόσβαση στη βάση. Για να πάρει δεδομένα, κάνει HTTP Requests (<code>HttpClient</code>) προς το API.
                        </li>
                    </ul>
                </div>
            </div>
        </div>

    </div>

    <div class="mt-5 text-center">
        <a href="login" class="btn btn-primary btn-lg px-5">Σύνδεση στην Εφαρμογή</a>
    </div>
</div>

@code {

}